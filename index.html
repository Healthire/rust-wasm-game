<!DOCTYPE html>
<html lang="en">

<head>
    <title>Test</title>
</head>

<body class="container">
    <script src="bundle.js"></script>
    <script>

        var sockets = [];

        function websocket_create(url_ptr) {
            let url_str = copyCStr(Module, url_ptr);
            var sock = new WebSocket(url_str);
            var len = sockets.push(sock);
            return len - 1;
        }

        function websocket_send(socket_id, data_ptr) {
            let data_str = copyCStr(Module, data_ptr);
            let sock = sockets[socket_id];
            sock.send(data_str);
        }


        window.Module = {}
        const imports = {
            env: {
                write: function (ptr) {
                    let str = copyCStr(Module, ptr);
                    console.log(str);
                },
                websocket_create: websocket_create,
                websocket_send: websocket_send
            }
        };

        window.addEventListener("load", function (event) {
            fetchAndInstantiate("target/wasm32-unknown-unknown/release/client.wasm", imports)
                .then(mod => {
                    console.log("Fetched " + mod);
                    Module.alloc = mod.exports.alloc;
                    Module.dealloc = mod.exports.dealloc;
                    Module.dealloc_str = mod.exports.dealloc_str;
                    Module.run = mod.exports.run;
                    Module.memory = new Uint8Array(mod.exports.memory.buffer)
                    Module.instance = mod;

                    Module.run();
                });
        });
    </script>

    <div id="console"></div>
</body>

</html>